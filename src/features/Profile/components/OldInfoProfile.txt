// import React, { useState, useEffect } from 'react';
// import { useForm, type SubmitHandler } from 'react-hook-form';
// import { useLocation } from 'react-router-dom';

// import axios from 'axios';
// import { yupResolver } from '@hookform/resolvers/yup';
// import * as yup from 'yup';

// import ButtonOrange from '../Button/ButtonCustomA';
// import AlertTitle, { type AlertType } from '../AlertTitle/AlertTitle';

// /**
//  *    ====== UI InfoProfile ======
//  * 
//  * Giao diện cho dữ liệu người dùng được lưu trong localStorage.
//  * Lấy từ RegisterPopup.tsx không bao gồm password và confirmPassword.
//  */
// interface StoredUser {
//   fullName: string;
//   phoneNumber: string;
//   dateOfBirth: string;
//   email?: string; // Email mới
// }


// // Giao diện cho dữ liệu form, chỉ chứa email, các field khác là chỉ đọc.
// interface ProfileFormData {
//   email: string;
// }


// // Init validate field
// const validationSchema = yup.object().shape({
//   email: yup
//     .string()
//     .email('Email không hợp lệ')
//     .required('Vui lòng nhập email'),
// });


// // Component InfoProfile
// const InfoProfile: React.FC = () => {
//   const location = useLocation();
//   const [currentUser, setCurrentUser] = useState<StoredUser | null>(null);

//   // Alert custom
//   const [alertState, setAlertState] = useState<{isOpen: boolean; type: AlertType; title: string; description?: string}>({
//     isOpen: false,
//     type: 'success',
//     title: ''
//   });

//   // Validate
//   const { register, handleSubmit, formState: { errors }, setValue } = useForm<ProfileFormData>({
//     resolver: yupResolver(validationSchema),
//   });


//   // Lấy thông tin user từ state của react-router khi điều hướng đến trang này
// // eslint-disable-next-line react-hooks/exhaustive-deps
// useEffect(() => {
//     const userFromState = location.state?.user as StoredUser | undefined;

//     if (userFromState) {
//       // Ưu tiên lấy thông tin người dùng được truyền qua state
//       setCurrentUser(userFromState);
//       setValue('email', userFromState.email || '');
//     } else {
//       // Phương án dự phòng: Lấy người dùng cuối cùng từ localStorage
//       // (Hữu ích khi refresh trang hoặc truy cập trực tiếp)
//       const existingUsersRaw = localStorage.getItem('registeredUsers');
//       if (existingUsersRaw) {

//         const existingUsers: StoredUser[] = JSON.parse(existingUsersRaw);
//         if (existingUsers.length > 0) {
//           const lastUser = existingUsers[existingUsers.length - 1];
//           setCurrentUser(lastUser);
//           setValue('email', lastUser.email || '');
//         }
//       }
//     }
//   }, [location.state, setValue]);


// // eslint-disable-next-line react-hooks/exhaustive-deps
// // useEffect(() => {
// //   const fetchUserData = async () => {
// //     const token = localStorage.getItem('token');
// //     try {
// //       // 1. Gọi API lấy thông tin mới nhất
// //       const response = await axios.get('https://api-dev.estuary.solutions:8443/ovaltine-web-api-dev/v1/members/me', {
// //         headers: { Authorization: `Bearer ${token}` }
// //       });
      
// //       // Kiểm tra cấu trúc response (soi F12 để chắc chắn)
// //       // Thường là response.data hoặc response.data.data
// //       const userData = response.data; 

// //       // 2. Cập nhật vào State để hiển thị ra màn hình
// //       setCurrentUser(userData);

// //       // 3. Fill dữ liệu vào các ô input (React Hook Form)
// //       // Nếu API trả về null/undefined thì để chuỗi rỗng
// //       setValue('email', userData.email || '');
// //       // setValue('fullName', userData.fullName || '');
// //       // setValue('phoneNumber', userData.phoneNumber || ''); 
// //       // ... set các trường khác nếu cần

// //       // (Tùy chọn) Cập nhật lại localStorage để các trang khác (Header) dùng chung
// //       localStorage.setItem('loggedInUser', JSON.stringify(userData));

// //     } catch (error) {
// //       console.error("Lỗi lấy thông tin profile:", error);
// //       // Nếu token hết hạn (lỗi 401), có thể đá ra trang chủ
// //       // navigate('/login');
// //     }
// //   };

// //   fetchUserData();
// // }, [setValue]);


//   // form lưu mail
//   const onSubmit: SubmitHandler<ProfileFormData> = (data) => {
//     if (!currentUser) return;

//     const existingUsersRaw = localStorage.getItem('registeredUsers');
//     const existingUsers: StoredUser[] = existingUsersRaw ? JSON.parse(existingUsersRaw) : [];

//     // Tìm và cập nhật email cho người dùng hiện tại
//     const userIndex = existingUsers.findIndex(user => user.phoneNumber === currentUser.phoneNumber);
//     if (userIndex !== -1) {
//       const updatedUser = { ...existingUsers[userIndex], email: data.email };
//       existingUsers[userIndex] = updatedUser;
//       localStorage.setItem('registeredUsers', JSON.stringify(existingUsers));
      
//       // Cập nhật lại thông tin user hiện tại để phản ánh thay đổi
//       setCurrentUser(updatedUser);

//       // ĐỒNG BỘ: Cập nhật cả 'loggedInUser' trong localStorage
//       const loggedInUserRaw = localStorage.getItem('loggedInUser');
//       if (loggedInUserRaw) {
//         localStorage.setItem('loggedInUser', JSON.stringify(updatedUser));
//       }

//       setAlertState({
//         isOpen: true,
//         type: 'success',
//         title: 'Cập nhật thành công!',
//         description: 'Email của bạn đã được lưu.'
//       });
//     } else {
//         setAlertState({
//             isOpen: true,
//             type: 'error',
//             title: 'Lỗi!',
//             description: 'Không tìm thấy người dùng để cập nhật.'
//         });
//     }
//   };


//   // const onSubmit: SubmitHandler<ProfileFormData> = async (data) => {
//   //   const token = localStorage.getItem('token');
//   //   try {
//   //     // 1. Chuẩn bị dữ liệu gửi đi
//   //     // Chỉ gửi những trường API cho phép sửa (Ví dụ ở đây là email)
//   //     const payload = {
//   //       email: data.email,
//   //       // Nếu API yêu cầu gửi cả tên/sđt thì thêm vào:
//   //       // fullName: currentUser?.fullName, 
//   //       // phoneNumber: currentUser?.phoneNumber
//   //     };

//   //     // 2. Gọi API Cập nhật
//   //     const response = await axios.put('https://api-dev.estuary.solutions:8443/ovaltine-web-api-dev/v1/members/me', payload, {
//   //       headers: { Authorization: `Bearer ${token}` }
//   //     });
//   //     const updatedUser = response.data; // Lấy user mới nhất từ server trả về

//   //     // 3. Cập nhật State hiển thị
//   //     setCurrentUser(updatedUser);

//   //     // 4. Cập nhật localStorage (chỉ để đồng bộ Client)
//   //     localStorage.setItem('loggedInUser', JSON.stringify(updatedUser));

//   //     setAlertState({
//   //       isOpen: true,
//   //       type: 'success',
//   //       title: 'Cập nhật thành công!',
//   //       description: 'Thông tin của bạn đã được lưu.'
//   //     });
//   //       // eslint-disable-next-line @typescript-eslint/no-explicit-any
//   //   } catch (error: any) {
//   //     console.error("Lỗi cập nhật:", error);
//   //     setAlertState({
//   //       isOpen: true,
//   //       type: 'error',
//   //       title: 'Lỗi cập nhật!',
//   //       description: error.response?.data?.message || 'Có lỗi xảy ra khi cập nhật.'
//   //     });
//   //   }
//   // };


//   if (!currentUser) {
//     return <div>Không tìm thấy thông tin người dùng. Vui lòng đăng ký.</div>;
//   }


//   const renderInput = (id:string, label:string, value:string, disabled:boolean = false) => (
//     <div className="relative pb-5">
//       <label htmlFor={id} className="block text-sm font-medium text-white/100 mb-1">
//         {label}
//       </label>
//       <input
//         id={id}
//         type="text"
//         defaultValue={value}
//         disabled={disabled}
//         className="w-full bg-white border rounded-[30px] p-2 focus:ring-2 outline-none transition border-white/30 focus:ring-[#233da3] disabled:bg-gray-200 disabled:cursor-not-allowed"
//       />
//     </div>
//   );


//   return (
//     <>
//       <AlertTitle
//         isOpen={alertState.isOpen}
//         type={alertState.type}
//         title={alertState.title}
//         description={alertState.description}
//         onClose={() => setAlertState({ ...alertState, isOpen: false })}
//       />
//       <div className="p-6 max-w-lg mx-auto bg-[url('/static/modal.png')] 
//                         bg-cover bg-center rounded-[20px] border-4 border-white mt-10 mb-10">
//         <h2 className="text-2xl font-bold text-center text-white mb-6">Thông tin tài khoản</h2>
//         {/* Form */}
//         <form onSubmit={handleSubmit(onSubmit)} className="flex flex-col gap-3 text-[#233da3]">
//           {renderInput("fullName", "Họ và tên", currentUser.fullName, true)}
//           {renderInput("phoneNumber", "Số điện thoại", currentUser.phoneNumber, true)}
//           {renderInput("dateOfBirth", "Ngày sinh", currentUser.dateOfBirth, true)}
//           {renderInput("city", "Thành phố", "HCM", true)}
          
//           <div className="relative pb-5">
//             <label htmlFor="email" className="block text-sm font-medium text-white/100 mb-1">
//               Email<span aria-hidden="true" className="text-[rgb(239,0,18)]">&thinsp;*</span>
//             </label>
//             <input
//               id="email"
//               type="email"
//               {...register("email")}
//               placeholder="Nhập email của bạn"
//               className={`w-full bg-white border rounded-[30px] p-2 focus:ring-2 outline-none transition ${errors.email ? 'border-red-500 focus:ring-red-500' : 'border-white/30 focus:ring-[#233da3]'}`}
//             />
//             {errors.email && <p className="absolute bottom-0 left-0 text-red-500 text-xs ml-2">{errors.email.message}</p>}
//           </div>

//           <ButtonOrange type="submit" className="w-[200px] h-12 text-lg mx-auto mt-4">Lưu thay đổi</ButtonOrange>
//         </form>
//       </div>

//     </>
//   );
// };

// export default InfoProfile;